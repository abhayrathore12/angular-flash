{"version":3,"sources":["../src/angular-flash.js"],"names":["app","angular","module","run","$rootScope","flashes","directive","$compile","restrict","replace","link","scope","ele","attrs","$watch","dynamic","html","contents","_transclude","clone","empty","append","Flash","on","id","parseInt","closeFlash","dismiss","$apply","duration","showClose","onDismiss","name","ctrl","transclude","setTimeout","setShowClose","flash","setOnDismiss","config","templateTransclude","template","provider","defaultConfig","templatePresets","bootstrap","timeout","value","setTemplate","setTemplatePreset","preset","callback","$get","$interval","dataFactory","counter","create","type","text","$this","push","timeoutObj","pause","index","cancel","findIndexById","splice","clear","length","reset","map","indexOf"],"mappings":"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","file":"angular-flash.js","sourcesContent":["const app = angular.module('ngFlash', []);\n\napp.run([\n    '$rootScope', function($rootScope) {\n        return $rootScope.flashes = [];\n    }\n]);\n\napp.directive('dynamic', [\n    '$compile', function($compile) {\n        return {\n            restrict: 'A',\n            replace: true,\n            link: function(scope, ele, attrs) {\n                return scope.$watch(attrs.dynamic, function(html) {\n                    ele.html(html);\n                    return $compile(ele.contents())(scope);\n                });\n            }\n        };\n    }\n]);\n\napp.directive('applytransclude', [\n    '$compile', function($compile) {\n        return {\n            restrict: 'A',\n            link: function(scope, ele, attrs) {\n                scope._transclude(scope, function(clone, scope) {\n                    ele.empty().append(clone);\n                });\n            }\n        };\n    }\n]);\n\napp.directive('closeFlash', [\n    '$compile', '$rootScope', 'Flash', function($compile, $rootScope, Flash) {\n        return {\n            link: function(scope, ele, attrs) {\n                return ele.on('click', function() {\n                    let id = parseInt(attrs.closeFlash, 10);\n                    Flash.dismiss(id);\n                    $rootScope.$apply();\n                });\n            }\n        };\n    }\n]);\n\napp.directive('flashMessage', [\n    'Flash', function(Flash) {\n        return {\n            restrict: 'E',\n            scope: {\n                duration: '=',\n                showClose: '=',\n                onDismiss: '&',\n                name: '@'\n            },\n            link: function(scope, ele, attrs, ctrl, transclude) {\n                Flash.setTimeout(scope.duration);\n                Flash.setShowClose(scope.showClose);\n                function onDismiss(flash) {\n                    if (typeof scope.onDismiss !== 'function') return;\n                    scope.onDismiss({flash: flash});\n                }\n\n                Flash.setOnDismiss(onDismiss);\n\n                if (Flash.config.templateTransclude) {\n                    scope._transclude = transclude;\n                }\n            },\n            transclude: Flash.config.templateTransclude,\n            template: `\n                <div ng-repeat=\"flash in $root.flashes track by $index\" ng-if=\"flash.config.container === name\" class=\"alert-container\">\n                    ` + Flash.config.template + `\n                </div>\n            `\n        };\n    }\n]);\n\napp.provider('Flash', function() {\n    let defaultConfig = {};\n    let templatePresets = {\n        bootstrap: {\n            html: `\n                <div role=\"alert\" id=\"{{flash.config.id}}\"\n                    class=\"alert {{flash.config.class}} alert-{{flash.type}} alert-dismissible alertIn alertOut\">\n                    <div type=\"button\" class=\"close\" ng-show=\"flash.showClose\" close-flash=\"{{flash.id}}\">\n                        <span aria-hidden=\"true\">&times;</span>\n                        <span class=\"sr-only\">Close</span>\n                    </div>\n                    <span dynamic=\"flash.text\"></span>\n                </div>`,\n            transclude: false\n        },\n        transclude: {\n            html: `<div applytransclude></div>`,\n            transclude: true\n        }\n    };\n\n    this.setTimeout = function(timeout) {\n        if (typeof timeout !== 'number') return;\n        defaultConfig.timeout = timeout;\n    };\n    this.setShowClose = function(value) {\n        if (typeof value !== 'boolean') return;\n        defaultConfig.showClose = value;\n    };\n    this.setTemplate = function(template) {\n        if (typeof template !== 'string') return;\n        defaultConfig.template = template;\n    };\n    this.setTemplatePreset = function(preset) {\n        if (typeof preset !== 'string'\n            || !(preset in templatePresets)) return;\n\n        let template = templatePresets[preset];\n        this.setTemplate(template.html);\n        defaultConfig.templateTransclude = template.transclude;\n    };\n    this.setOnDismiss = function(callback) {\n        if (typeof callback !== 'function') return;\n        defaultConfig.onDismiss = callback;\n    };\n\n    this.setTimeout(5000);\n    this.setShowClose(true);\n    this.setTemplatePreset('bootstrap');\n\n    this.$get = ['$rootScope', '$interval', function($rootScope, $interval) {\n        const dataFactory = {};\n        let counter = 0;\n\n        dataFactory.setTimeout = this.setTimeout;\n        dataFactory.setShowClose = this.setShowClose;\n        dataFactory.setOnDismiss = this.setOnDismiss;\n        dataFactory.config = defaultConfig;\n\n        dataFactory.create = function(type, text, timeout, config, showClose) {\n            if (!text) return false;\n            let $this, flash;\n            $this = this;\n            flash = {\n                type: type,\n                text: text,\n                config: config,\n                id: counter++\n            };\n            flash.showClose =\n                typeof showClose !== 'undefined' ?\n                    showClose : defaultConfig.showClose;\n            if (defaultConfig.timeout && typeof timeout === 'undefined') {\n                flash.timeout = defaultConfig.timeout;\n            }\n            else if (timeout) {\n                flash.timeout = timeout;\n            }\n            $rootScope.flashes.push(flash);\n            if (flash.timeout) {\n                flash.timeoutObj = $interval(function() {\n                    $this.dismiss(flash.id);\n                }, flash.timeout, 1);\n            }\n            return flash.id;\n        };\n        dataFactory.pause = function(index) {\n            if ($rootScope.flashes[index].timeoutObj) {\n                $interval.cancel($rootScope.flashes[index].timeoutObj);\n            }\n        };\n        dataFactory.dismiss = function(id) {\n            const index = findIndexById(id);\n            if (index !== -1) {\n                const flash = $rootScope.flashes[index];\n                dataFactory.pause(index);\n                $rootScope.flashes.splice(index, 1);\n                if (typeof defaultConfig.onDismiss === 'function') {\n                    defaultConfig.onDismiss(flash);\n                }\n            }\n        };\n        dataFactory.clear = function() {\n            while ($rootScope.flashes.length > 0) {\n                dataFactory.dismiss($rootScope.flashes[0].id);\n            }\n        };\n        dataFactory.reset = dataFactory.clear;\n        function findIndexById(id) {\n            return $rootScope.flashes.map((flash) => flash.id).indexOf(id);\n        }\n\n        return dataFactory;\n    }];\n});\n"]}